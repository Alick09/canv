(()=>{var t={349:function(t){var e;e=()=>(()=>{"use strict";var t={d:(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Space:()=>f,SpriteDrawer:()=>P,addPosEventListener:()=>y,allUnderTouch:()=>p,findUnderTouch:()=>v,getPos:()=>i,installCanvasControll:()=>C,installClicks:()=>g,installMoveObjects:()=>O,installSelection:()=>m,onLongPress:()=>w,setupMoveEvents:()=>M});var n=function(){return n=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},n.apply(this,arguments)},a=function(t){var e=i(t||{x:0,y:0});return n(n({},e),{add:function(t){return a({x:e.x+t.x,y:e.y+t.y})},sub:function(t){return a({x:e.x-t.x,y:e.y-t.y})},mul:function(t){return a({x:e.x*t,y:e.y*t})}})},i=function(t){var e=function(t){return"function"==typeof t?t():t};return{x:e(t.x),y:e(t.y)}},o=function(t,e,n){if(0==n)return t;var i={x:t.x-e.x,y:t.y-e.y},o=Math.hypot(i.x,i.y);if(o<1e-6)return t;var r=Math.atan2(i.y,i.x)+n,s={x:Math.cos(r)*o,y:Math.sin(r)*o};return a(e).add(s)},r=function(t,e,n){var r=e.center,s=void 0===r?{x:0,y:0}:r,c=e.scale,l=void 0===c?1:c,d=e.angle,u=void 0===d?0:d,h=e.rotationCenter,f=void 0===h?{x:0,y:0}:h;return o(a(t).sub(i(s)).sub(n||{x:0,y:0}).mul(1/l),f,-u)},s=function(t,e,n){var r=e.center,s=void 0===r?{x:0,y:0}:r,c=e.scale,l=void 0===c?1:c,d=e.angle,u=void 0===d?0:d,h=e.rotationCenter;return a(o(t,void 0===h?{x:0,y:0}:h,u)).mul(l).add(n||{x:0,y:0}).add(i(s))},c=function(t,e,n){var a=e.center,o=e.angle,r=e.rotationCenter,s=e.scale;if(a){var c=i(a);t.translate(c.x,c.y)}n&&t.translate(n.x,n.y),s&&t.scale(s,s),o&&(r&&t.translate(r.x,r.y),t.rotate(o),r&&t.translate(-r.x,-r.y))},l=function(t,e){if(e.rotationCenter&&e.angle){var n=o(t,e.rotationCenter,e.angle),a={x:n.x-t.x,y:n.y-t.y},r=i(e.center||{x:0,y:0});return Object.assign(e,{center:{x:r.x+a.x,y:r.y+a.y},rotationCenter:t}),a}return e.rotationCenter=t,{x:0,y:0}},d=function(){return d=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},d.apply(this,arguments)},u=function(t){var e={center:{x:t.x||0,y:t.y||0},angle:t.angle,scale:t.scale,rotationCenter:t.rotationCenter};if(t.selectable&&void 0===t.checkInside)throw TypeError("Drawable should have checkInside method to be selectable");var n={selected:!1,space:null},a={x:0,y:0},o={func:function(t){return!1},queue:[],start:-1,lastT:0},l=function(t){void 0===t&&(t=-1);var e=o.queue.shift();e&&(o.func=e,o.start=t)};function h(){var t,e=d({},this.position),n=this.orig.fixedOrientation,a=this.orig.fixedPosition,o=this.orig.fixedScale;if(n||a||o){var r=this.getSpace();if(r&&(n&&(e.angle=(e.angle||0)-((null===(t=r.position)||void 0===t?void 0:t.angle)||0)),a&&e.center)){var s=i(e.center);e.center=r.transform(s)}}return e}var f=function(t){return"function"==typeof t.visible?t.visible():t.visible},v={id:t.id||(Math.random()+1).toString(36).substring(2),parent:void 0,orig:t,inAnimationLoop:!1,selectable:t.selectable||!1,movable:t.movable||!1,position:e,visible:t.visible||!0,data:t.data,children:void 0,draw:function(e){if(f(this)){var n=h.call(this);c(e,n),e.save(),t.draw.call(this,e),e.restore(),this.children&&this.children.forEach((function(t){e.save(),t.draw(e),e.restore()}))}},getSpace:function(){if(!n.space){if(!this.parent)throw ReferenceError("Couldn't traverse to space from object. Parent is null.");"selectable"in this.parent?n.space=this.parent.getSpace():n.space=this.parent}return n.space},checkInside:function(e){if(!t.checkInside||!f(this))return!1;var n=this.transform(e),i=t.checkInside.call(this,n);return i&&Object.assign(a,n),i},selected:function(t){return void 0!==t&&(n.selected=t),n.selected},click:function(){t.onClick&&t.onClick(a)},clickable:function(){return void 0!==t.onClick},transform:function(t,e){if(e&&"selectable"in e&&e.id==this.id)return t;var n=this.parent?this.parent.transform(t):t;return r(n,this.position)},backTransform:function(t,e){if(e&&"selectable"in e&&e.id==this.id)return t;var n=s(t,this.position);return this.parent?this.parent.backTransform(n):n},animate:function(t){var e=t.animation,n=t.force,a=void 0!==n&&n,i=t.putToQueue,r=void 0!==i&&i;a||!this.inAnimationLoop?(this.inAnimationLoop=!0,o.func=e,o.start=-1,this.getSpace().triggerAnimation()):r&&o.queue.push(e)},stopAnimation:function(t){void 0===t&&(t=!1),t||0==o.queue.length?this.inAnimationLoop=!1:l()},applyAnimation:function(t){if(!this.inAnimationLoop)return!1;if(o.start<0)o.start=t;else{var e=t-o.start,n=o.func.call(this,e,e-o.lastT);o.lastT=e,n||(0==o.queue.length?this.inAnimationLoop=!1:l(t))}return this.inAnimationLoop},resetPosition:function(){Object.assign(this.position,{center:{x:t.x||0,y:t.y||0},angle:t.angle,scale:t.scale,rotationCenter:t.rotationCenter})},plainObjects:function(){var t=[this];return this.children&&this.children.forEach((function(e){return t.push.apply(t,e.plainObjects())})),t},addObject:function(t){return this.getSpace().resetObjectCache(),t.parent=this,this.children||(this.children=[]),this.children.push(t),t},addDrawable:function(t){var e=u(t);return this.addObject(e)},spliceObject:function(t,e,n){return this.getSpace().resetObjectCache(),n.parent=this,this.children||(this.children=[]),this.children.splice(t,e,n),n},spliceDrawable:function(t,e,n){var a=u(n);return this.spliceObject(t,e,a)}};return t.objRef=v,t.children&&(v.children=t.children.map((function(t){var e=u(t);return e.parent=v,e}))),v},h=function(){return h=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},h.apply(this,arguments)},f=function(t,e){var n=t.getContext("2d");if(null===n)throw TypeError("Can't get context2d from canvas");var a={center:{x:0,y:0},scale:e.scale,angle:e.angle,rotationCenter:Object.assign({x:0,y:0},e.rotationCenter)},o=function(){var t=y.position,e=(y.position.scale||1)*y.pixelRatio,n=i(t.center||{x:0,y:0});return h(h({},t),{scale:e,center:{x:n.x*e,y:n.y*e}})},l=i(e.center||{x:0,y:0}),d=function(){var e=(y.position.scale||1)*y.pixelRatio;return{x:t.width/2-e*l.x,y:t.height/2-e*l.y}},f=!1,v=function(){var t=Date.now(),e=!1;y.allObjects().forEach((function(n){n.applyAnimation(t)&&(e=!0)})),e?(y.draw(),requestAnimationFrame(v)):f=!1},p=null,y={options:e,canvas:t,objects:[],allObjects:function(){return p||(p=this.objects.reduce((function(t,e){return t.concat(e.plainObjects())}),[])),p},pixelRatio:1,position:a,resetObjectCache:function(){p=null},addObject:function(t){return t.parent=this,this.objects.push(t),this.resetObjectCache(),t},addDrawable:function(t){return this.addObject(u(t))},draw:function(){n.clearRect(0,0,t.width,t.height),c(n,o(),d()),this.objects.forEach((function(t){n.save(),t.draw(n),n.restore()})),n.resetTransform()},triggerAnimation:function(){f||(f=!0,requestAnimationFrame(v))},launch:function(){var t=this;if(this.options.animationTick){var e=this,n=Date.now(),a=function(){t.options.animationTick&&(t.options.animationTick.call(e,Date.now()-n),t.draw(),requestAnimationFrame(a))};requestAnimationFrame(a)}else console.warn("Set animationTick in space options to make animation work. Ignoring launch.")},stopAnimation:function(){this.options.animationTick=void 0},transform:function(t,e){if(e&&"canvas"in e)return t;var n=this.pixelRatio;return r({x:t.x*n,y:t.y*n},o(),d())},backTransform:function(t,e){if(e&&"canvas"in e)return t;var n=this.pixelRatio,a=s({x:t.x,y:t.y},o(),d());return{x:a.x/n,y:a.y/n}},reset:function(){this.objects=[],this.stopAnimation(),f=!1,this.position={center:{x:0,y:0},scale:e.scale,angle:e.angle,rotationCenter:Object.assign({x:0,y:0},e.rotationCenter)}},getBBox:function(t){void 0===t&&(t=!1);var e={x:0,y:0},n={x:this.canvas.offsetWidth,y:this.canvas.offsetHeight};if(!t)return h(h({},e),{w:n.x,h:n.y});var a=this.transform(e),i=this.transform(n);return h(h({},a),{w:i.x-a.x,h:i.y-a.y})},getBBoxPolygon:function(){var t=this,e=this.canvas.offsetWidth,n=this.canvas.offsetHeight;return[{x:0,y:0},{x:e,y:0},{x:e,y:n},{x:0,y:n}].map((function(e){return t.transform(e)}))}};return y.pixelRatio=function(t,e){var n=e.pixelRatio,a=e.onResize,i=e.setupAutoResize,o=1;return(void 0===i||i)&&(a||(o=n||Math.ceil(window.devicePixelRatio),a=function(){t.canvas.width=t.canvas.offsetWidth*o,t.canvas.height=t.canvas.offsetHeight*o,t.draw()}),window.onresize=a,a()),o}(y,e),y},v=function(t){var e=t.space,n=t.pos,a=t.filter,i=t.prepare,o=t.getFirst,r=void 0!==o&&o,s=null;return e.allObjects().forEach((function(t){i&&i(t),r&&null!=s||a&&!a(t)||!t.checkInside(n)||(s=t)})),s},p=function(t){var e=t.space,n=t.pos,a=t.filter,i=t.prepare;return e.allObjects().filter((function(t){return i&&i(t),(!a||a(t))&&t.checkInside(n)}))},y=function(t,e,n){t.canvas.addEventListener(e,(function(t){n({x:t.offsetX,y:t.offsetY},t)}))},m=function(t,e){void 0===e&&(e={}),e=Object.assign({firstIfMany:!1,filter:function(t){return t.selectable}},e);var n=[];return y(t,"click",(function(a){var i=v({space:t,pos:a,getFirst:e.firstIfMany,filter:e.filter,prepare:function(t){return t.selected(!1)}});null!==i&&i.selected(!0),n.forEach((function(t){return t(i||void 0)})),t.draw()})),{onSelected:function(t){n.push(t)}}},g=function(t,e){return void 0===e&&(e={}),e=Object.assign({firstIfMany:!1,filter:function(t){return t.clickable()}},e),y(t,"click",(function(n){var a=v({space:t,pos:n,getFirst:e.firstIfMany,filter:e.filter});null!==a&&a.click(),t.draw()})),{}},b=function(){return b=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},b.apply(this,arguments)},x=function(t,e){var n=Array.from(t).filter((function(t){return t.identifier<2})).sort((function(t,e){return t.identifier-e.identifier})).map((function(t){return{x:t.clientX-e.x,y:t.clientY-e.y}}));if(0==n.length)return{center:void 0,rotate:void 0,distance:void 0,fingerCount:0};var a=n.reduce((function(t,e){return{x:t.x+e.x,y:t.y+e.y}}),{x:0,y:0}),i={distance:void 0,rotate:void 0,count:n.length};if(n.length>1){var o={x:n[0].x-n[1].x,y:n[0].y-n[1].y};i.distance=Math.hypot(o.x,o.y),i.rotate=Math.atan2(o.y,o.x)}return b({center:{x:a.x/n.length,y:a.y/n.length},fingerCount:t.length},i)},w=function(t,e){var n=e.handler,a=e.pressDurationThreshold,i=void 0===a?700:a,o=e.jitterRadius,r=void 0===o?20:o,s={pos:void 0,time:void 0},c=t.canvas.getBoundingClientRect(),l=function(t,e){var a=x(t.touches,c);if(1!==a.fingerCount||"cancel"==e)s.pos=void 0;else if(a.center){if("start"==e&&(Object.assign(s,{pos:a.center,time:Date.now()}),setTimeout((function(){s.pos&&n(a.center)}),i)),void 0===s.pos)return;"move"==e&&Math.hypot(a.center.x-s.pos.x,a.center.y-s.pos.y)>r&&(s.pos=void 0)}};t.canvas.addEventListener("touchstart",(function(t){return l(t,"start")})),t.canvas.addEventListener("touchend",(function(t){return l(t,"end")})),t.canvas.addEventListener("touchcancel",(function(t){return l(t,"cancel")})),t.canvas.addEventListener("touchmove",(function(t){return l(t,"move")}))},M=function(t,e,n){var i;t.canvas.style.touchAction="none",t.canvas.style.userSelect="none";var o=Object.assign({ctrlWheelScale:!0,rotationThreshold:0,enable:function(){return!0},onMoveStart:function(t){},onMove:function(t){},onMoveEnd:function(){},leftMouseButtonOnly:!0,disableMacWheelMove:!1},n||{}),r={startPos:{x:0,y:0},startCanvPos:a({x:0,y:0}),moving:!1,lastContinuousMove:0,continuousPoint:a(),continuousMoving:!1},s=function(n,i){!o.enable()||i&&o.leftMouseButtonOnly&&0!=i.button||(o.onMoveStart(n),r.startPos=n,r.startCanvPos=a(t.position.center),e.startMove?(r.moving=e.startMove(n),t.draw()):r.moving=!0)},c=function(n){if(r.moving&&o.enable()){o.onMove(n);var i=t.position.scale||1,s=a(n).sub(r.startPos).mul(1/i);e.move&&(e.move(n,s),t.draw())}},l=function(){o.enable()&&(o.onMoveEnd(),r.moving=!1,e.endMove&&(e.endMove(),t.draw()))},d=function(n){!o.disableScale&&e.scale&&o.enable()&&(e.scale(n),t.draw())},u=function(n,a){!o.disableRotation&&e.rotate&&o.enable()&&(e.rotate(n,a),t.draw())},h=o.scaleForce||.05,f=o.rotateForce||.02,v=((null===(i=null===navigator||void 0===navigator?void 0:navigator.userAgentData)||void 0===i?void 0:i.platform)||(null===navigator||void 0===navigator?void 0:navigator.platform)||"unknown").toLowerCase().indexOf("mac")>=0;return t.canvas.addEventListener("wheel",(function(n){var i=o.ctrlWheelRotate&&n.ctrlKey?1:o.ctrlWheelScale&&n.ctrlKey?2:o.wheelRotate&&!n.ctrlKey?1:v&&!o.disableMacWheelMove?3:4;if(1==i){var s=n.deltaY>.1?f:n.deltaY<-.1?-f:0;u(s,{x:n.offsetX,y:n.offsetY})}else 2==i?d(n.deltaY>.1?1-h:n.deltaY<-.1?1/(1-h):1):3==i&&function(n,i){if(!r.continuousMoving&&e.startMove&&(r.continuousMoving=e.startMove(n),r.continuousPoint=a(n),r.startPos=n,t.draw()),e.move){var o=t.position.scale||1;r.continuousPoint=r.continuousPoint.add(i),e.move(r.startPos,r.continuousPoint.sub(r.startPos).mul(1/o)),t.draw()}r.lastContinuousMove=Date.now(),setTimeout((function(){Date.now()-r.lastContinuousMove>150&&(e.endMove&&e.endMove(),r.continuousMoving=!1)}),200)}({x:n.offsetX,y:n.offsetY},{x:.7*-n.deltaX,y:.7*-n.deltaY});n.preventDefault()})),y(t,"mousedown",s),y(t,"mouseup",l),y(t,"mousemove",c),function(t,e,n){var a=e.startMove,i=e.endMove,o=e.move,r=e.scale,s=e.rotate,c={center:void 0,rotate:void 0,distance:void 0,count:0},l={angleAccum:0,enabled:!1},d=t.canvas.getBoundingClientRect(),u=function(t,e){var u=x(t.touches,d);c.distance&&u.distance&&r(u.distance/c.distance),c.rotate&&u.rotate?(l.angleAccum+=u.rotate-c.rotate,l.enabled?s(u.rotate-c.rotate,u.center):Math.abs(l.angleAccum)>n&&(l.enabled=!0)):(u.rotate||Object.assign(l,{angleAccum:0,enabled:!1}),u.center&&!c.center?a(u.center):!u.center&&c.center?i():u.center&&c.center&&(u.count!==c.count?a(u.center):o(u.center))),Object.assign(c,u)};t.canvas.addEventListener("touchstart",(function(t){return u(t)})),t.canvas.addEventListener("touchend",(function(t){return u(t)})),t.canvas.addEventListener("touchcancel",(function(t){return u(t)})),t.canvas.addEventListener("touchmove",(function(t){return u(t)}))}(t,{startMove:s,move:c,endMove:l,rotate:u,scale:d},o.rotationThreshold),{moving:function(){return r.moving||r.continuousMoving}}},C=function(t,e){var n=a();return M(t,{startMove:function(e){return n=a(t.position.center),!0},move:function(e,a){t.position.center=n.add(a)},scale:function(e){t.position.scale=(t.position.scale||1)*e},rotate:function(e,n){l(t.transform(n),t.position),t.position.angle=(t.position.angle||0)+e}},e)},j=function(){return j=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},j.apply(this,arguments)},O=function(t,e){var n={pos:a(),object:void 0},i={};return j(j({},M(t,{startMove:function(i){var o=v({space:t,pos:i,filter:function(t){return t.movable&&t.selected()}});return!!o&&(Object.assign(n,{pos:a(o.position.center),object:o}),e&&e.onObjectMove&&e.onObjectMove(n,"start"),!0)},move:function(t,a){if(n.object){var o=n.pos.add(a);n.object.position.center=(null==e?void 0:e.posConstraint)?e.posConstraint(o,n.object):o,i[n.object.id]=n.object.position,e&&e.onObjectMove&&e.onObjectMove(n,"move")}},endMove:function(){n.object&&e&&e.onObjectMove&&e.onObjectMove(n,"end"),n.object=void 0},scale:function(t){if(n.object){var e=n.object.position;e.scale=(e.scale||1)*t}},rotate:function(t,e){n.object&&(l(n.object.transform(e),n.object.position),n.object.position.angle=(n.object.position.angle||0)+t)}},Object.assign({disableMacWheelMove:!0},e))),{getChanged:function(){return i},resetChanged:function(){i={}}})},S=function(t){var e=t.url,n=t.content,a=t.base64,i=t.dataType,o=void 0===i?"image/svg+xml":i;if(!e&&!n&&!a)throw TypeError("You should initialize sprite drawer with url, content or base64");if(e)return e;var r=a;return!r&&n&&(r=n instanceof SVGElement?window.btoa(n.outerHTML):window.btoa(n)),"data:".concat(o,";base64,").concat(r)},P=function(t){var e=t.size,n=void 0===e?{w:0,h:0}:e,a=t.drawLoading,i=t.space,o=t.crop,r=void 0===o?{}:o,s=t.animationConfig,c=function(t,e){var n={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(n[a]=t[a]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(t);i<a.length;i++)e.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(t,a[i])&&(n[a[i]]=t[a[i]])}return n}(t,["size","drawLoading","space","crop","animationConfig"]),l=new Image(n.w?n.w:void 0,n.h?n.h:void 0),d=a||function(t){t.beginPath(),t.fillStyle="#00000080";var e=n.w||100,a=n.h||100;t.rect(-e/2,-a/2,e,a),t.fill(),t.closePath()},u={loaded:!1,frame:void 0,animationConfig:s,url:S(c),reloadImage:function(t){this.url=S(t||c),l.src=this.url},draw:function(t){this.loaded?function(t,e){var a={left:r.left||0,top:r.top||0,width:r.width||0,height:r.height||0},i=n.w,o=n.h;e.frame&&(Object.assign(a,e.frame),i=e.frame.width,o=e.frame.height),t.drawImage(l,a.left,a.top,a.width,a.height,-i/2,-o/2,i,o)}(t,this):d(t)},animate:function(t,e){var n,a=this;if(!this.animationConfig)return function(t){return!1};var i=1e3/t,o=(null===(n=this.animationConfig)||void 0===n?void 0:n.frameCount)||1;return function(t){var n,r=0|t/i,s=r%o;return a.frame=null===(n=a.animationConfig)||void 0===n?void 0:n.getFrame(s),void 0===e||r/o<e}}};return s&&(u.frame=s.getFrame(s.defaultIndex||0)),l.onload=function(){u.loaded=!0,0===n.w&&(n.w=l.naturalWidth-(r.left||0),n.h=l.naturalHeight-(r.top||0)),r.width=r.width||l.naturalWidth-(r.left||0),r.height=r.height||l.naturalHeight-(r.top||0),i&&i.draw()},l.src=u.url,u};return e})(),t.exports=e()}},e={};function n(a){var i=e[a];if(void 0!==i)return i.exports;var o=e[a]={exports:{}};return t[a].call(o.exports,o,o.exports,n),o.exports}(()=>{"use strict";var t=n(349);const e=()=>{const t=[];for(let e=-760;e<=760;e+=80)for(let n=-760;n<=760;n+=80)t.push({x:n,y:e,draw(t){t.beginPath(),t.fillStyle=this.selected()?"#f00":"#000",t.rect(-22.5,-22.5,45,45),t.fill(),t.closePath()},checkInside:({x:t,y:e})=>Math.abs(t)<22.5&&Math.abs(e)<22.5});return t},a=({count:t=20,mainStep:e=100,secondaryDivisions:n=2})=>{const a=t*e,i=({ctx:t,pos:e,width:n,color:i="#888",horizontal:o=!0})=>{t.beginPath(),t.lineWidth=n,t.strokeStyle=i,o?(t.moveTo(-a,e),t.lineTo(a,e)):(t.moveTo(e,-a),t.lineTo(e,a)),t.stroke(),t.closePath()};return{x:0,y:0,draw(a){for(let o=-t;o<=t;++o){let r=e*o;if(i({ctx:a,pos:r,width:2,horizontal:!0}),i({ctx:a,pos:r,width:2,horizontal:!1}),o<t)for(let t=1;t<n;++t){const o=r+t/n*e;i({ctx:a,pos:o,color:"#ccc",width:1,horizontal:!0}),i({ctx:a,pos:o,color:"#ccc",width:1,horizontal:!1})}}}}},i=(t,e,n=1)=>{const a=[];for(let i=t;i<e;i+=n)a.push(i);return a},o=(t,e)=>({draw(n){n.beginPath(),n.arc(0,0,t,0,2*Math.PI);const a="function"==typeof e?e():e;n.fillStyle=this.selected()?"#f00":a,n.fill(),n.closePath()},checkInside:e=>Math.hypot(e.x,e.y)<t}),r=[],s=(t,e)=>({x:t,y:e,scale:1,data:i(0,16).map((t=>{const e=Math.PI*t/8,n={x:Math.cos(e),y:Math.sin(e)};return{x:150*n.x,y:150*n.y,length:150,d:n}})),draw(t){t.beginPath(),this.data.forEach((e=>{t.lineTo(e.x,e.y)})),t.strokeStyle="#137085",t.lineWidth=5,t.closePath(),t.stroke()}}),c=()=>({x:0,y:0,onClick(t){r[0].animate({animation(t){const e=t/300;return this.position.scale=1+Math.sin(e),e<Math.PI}}),r[1].animate({animation(t){const e=t/300;return this.position.center={x:400+100*Math.cos(e),y:100*Math.sin(e)},e<2*Math.PI}}),r[2].animate({animation(t){return this.data.forEach((e=>{var n;e.length+=e.speed||0,e.speed=(n=(e.speed||0)+(e.force||0))>3?3:n<-3?-3:n,t>(e.nextForceChange||0)&&(e.force=Math.random()-.5-(e.length-150)/20,e.nextForceChange=t+50),e.x=e.d.x*e.length,e.y=e.d.y*e.length})),t<1e4}})},...o(50,"#333")}),l=(t,e,n,a)=>({x:t,y:e,scale:n,draw(t){a.draw(t)}}),d=(t,e,n)=>({x:t,y:e,scale:.8,data:n,draw(t){n.draw(t)}}),u=(t,e)=>{const n=[0,1,2,3,4,5].map((t=>t*Math.PI/3)),a=Math.PI/6;return{x:t,y:e,scale:1,movable:!0,selectable:!0,children:[...n.map((t=>({x:60*Math.cos(t),y:60*Math.sin(t),selectable:!0,movable:!0,...o(15,"#000000")}))),...n.map((t=>({x:80*Math.cos(t+a),y:80*Math.sin(t+a),...o(10,"#000000")})))],...o(40,"#00ff00")}},h=(t,e)=>Math.hypot(t.x-e.x,t.y-e.y),f=(t,e,n=null)=>{const a={x:e.x-t.x,y:e.y-t.y};if(null==n)return a;const i=Math.hypot(a.x,a.y);return{x:a.x*n/i,y:a.y*n/i}};class v{constructor(e){this.space=e,this.speed={x:0,y:0,max:.3},this.accel={x:0,y:0},this._health=1,this._player=null,this._gameOver=!1,this._spawnEnemyInterval=null,this._enemies=[],this._score=0,this.maxEnemies=10,document.addEventListener("keydown",(t=>{if(this._gameOver)return;const e=.005;switch(t.code){case"KeyA":this.accel.x=-e;break;case"KeyW":this.accel.y=-e;break;case"KeyD":this.accel.x=e;break;case"KeyS":this.accel.y=e}})),document.addEventListener("keyup",(t=>{switch(t.code){case"KeyA":this.accel.x<0&&(this.accel.x=0);break;case"KeyW":this.accel.y<0&&(this.accel.y=0);break;case"KeyD":this.accel.x>0&&(this.accel.x=0);break;case"KeyS":this.accel.y>0&&(this.accel.y=0)}})),(0,t.addPosEventListener)(e,"click",((t,n)=>{if(this._gameOver)return;const a=this._player.position.center,i=f(a,e.transform(t),.5);e.addDrawable({...a,data:this,visible:!0,...o(7,"black")}).animate({animation(t,e){return this.position.center.x+=i.x*e,this.position.center.y+=i.y*e,(this.data._enemies.some((t=>{if(!t.data.dead&&h(t.position.center,this.position.center)<27)return t.data.damage++,7==t.data.damage&&(t.data.dead=!0,this.data._score++),!0}))||t>=3e3)&&(this.visible=!1),this.visible}}),n.preventDefault()}))}addPlayer(){const t={x:0,y:0,data:this,...o(20,"#00aa77")};this._player=this.space.addDrawable(t)}gameOver(){this._health=0,this._gameOver=!0,clearInterval(this._spawnEnemyInterval),this._enemies.forEach((t=>{t.data.dead=!0}))}spawnEnemy(){if(this._enemies=this._enemies.filter((t=>!t.data.dead)),this._enemies.length<this.maxEnemies){const t=Math.random()*Math.PI*2,e=this.space.getBBox(),n=Math.hypot(e.w,e.h)/2,a=this.space.addDrawable({x:e.x+e.w/2+Math.cos(t)*n,y:e.y+e.h/2+Math.sin(t)*n,data:{dead:!1,damage:0,g:this,player:this._player},visible(){return!this.data.dead},...o(20,(()=>`rgb(${255-20*a.data.damage}, 0, 50)`))});a.animate({animation(t,e){const n=f(this.position.center,this.data.player.position.center,.2);return this.position.center.x+=n.x*e,this.position.center.y+=n.y*e,h(this.position.center,this.data.player.position.center)<40&&(this.data.g._health-=1e-4*e),this.data.g._health<0&&this.data.g.gameOver(),!this.data.dead}}),this._enemies.push(a)}}run(){this._player.animate({animation(t,e){const n=this.data,a=((t,e,n,a,i)=>{e.x=Math.max(-a,Math.min(a,e.x+n.x)),e.y=Math.max(-a,Math.min(a,e.y+n.y)),0==n.x&&(e.x*=.99),0==n.y&&(e.y*=.99);const o=Math.hypot(e.x,e.y);return t.x+=i*e.x*a/Math.max(o,a),t.y+=i*e.y*a/Math.max(o,a),t})(this.position.center,n.speed,n.accel,n.speed.max,e);return n.space.position.center={x:-a.x,y:-a.y},!this._gameOver}}),this._spawnEnemyInterval=setInterval((()=>{this.spawnEnemy()}),1e3)}addHud(){const t=this.space.getBBox(!1).w/50;this.space.addDrawable({fixedPosition:!0,data:this,draw(e){e.fillStyle="#999",e.fillRect(t,t,20*t,t),e.fillStyle="#f53",e.fillRect(t,t,20*t*this.data._health,t),e.font="30px Arial",e.fillStyle="#333";const n=this.data._gameOver?"Game over. ":"";e.fillText(n+`Score: ${this.data._score}`,t,4*t)}})}}const p={simple:n=>{let a=1;const i=(0,t.Space)(n,{animationTick(t){const{scale:e,angle:n}=this.position;e>2?a=-1:e<.7&&(a=1),this.position.scale=(e||1)*(1+.001*a),this.position.angle=(n||0)+.003,this.objects.forEach((t=>{t.position.angle=(t.position.angle||0)-.03}))}});e().forEach((t=>i.addDrawable(t))),i.launch()},animation:e=>{const n=(0,t.Space)(e,{scale:.6});n.addDrawable(a({mainStep:200})),r.push(n.addDrawable(s(-500,0))),r.push(n.addDrawable(s(500,0))),r.push(n.addDrawable(s(0,-500))),n.addDrawable(c()),(0,t.installClicks)(n,{}),(0,t.installCanvasControll)(n,{disableRotation:!0}),n.draw()},selection:n=>{const a=(0,t.Space)(n,{scale:.6});e().forEach((t=>a.addDrawable({selectable:!0,angle:Math.random(),scale:Math.random()+.5,...t}))),(0,t.installSelection)(a),(0,t.installCanvasControll)(a),a.draw()},sprite:e=>{const n=(0,t.Space)(e,{scale:.6});n.addDrawable(a({mainStep:200})),n.addDrawable(l(-500,0,.5,(0,t.SpriteDrawer)({url:"./resources/lenna.png",space:n,crop:{left:200}}))),n.addDrawable(l(0,0,1.2,(0,t.SpriteDrawer)({url:"./resources/logo.svg",space:n}))),n.addDrawable(l(500,0,5,(0,t.SpriteDrawer)({content:'\n        <svg width="26" height="24" viewBox="0 0 26 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M25.926 11.3664C25.926 10.3408 25.364 9.45492 24.5371 8.97401V2.33903C24.5371 1.95926 24.2342 0.949707 23.1482 0.949707C22.8392 0.949707 22.5324 1.05301 22.2811 1.25439L18.5905 4.20709C16.7368 5.68886 14.4095 6.50526 12.0371 6.50526H3.7038C2.16952 6.50526 0.926025 7.74875 0.926025 9.28304V13.4497C0.926025 14.984 2.16952 16.2275 3.7038 16.2275H5.16648C5.10615 16.6823 5.07186 17.145 5.07186 17.6164C5.07186 19.3425 5.47377 20.9736 6.18123 22.4315C6.40649 22.8955 6.89825 23.1719 7.41387 23.1719H10.6378C11.7685 23.1719 12.4473 21.8768 11.762 20.9775C11.0502 20.0435 10.627 18.8785 10.627 17.6164C10.627 17.1342 10.6973 16.6706 10.8184 16.2275H12.0371C14.4095 16.2275 16.7368 17.0439 18.5901 18.5257L22.2806 21.4784C22.5268 21.6753 22.8326 21.7828 23.1478 21.783C24.2294 21.783 24.5367 20.7943 24.5367 20.3941V13.7592C25.364 13.2778 25.926 12.392 25.926 11.3664ZM21.7594 17.5044L20.3249 16.3568C17.9811 14.4818 15.0371 13.4497 12.0371 13.4497V9.28304C15.0371 9.28304 17.9811 8.25092 20.3249 6.37592L21.7594 5.22835V17.5044Z" fill="black"/>\n        </svg>    \n    ',space:n}))),(0,t.installCanvasControll)(n,{disableRotation:!0}),(0,t.onLongPress)(n,{handler:t=>{alert(`Long: ${t}`)}}),n.draw()},spriteAnimation:e=>{const n=(0,t.Space)(e,{scale:.4});n.addDrawable(a({mainStep:200})),n.addDrawable(d(0,-200,(0,t.SpriteDrawer)({url:"./resources/bunny_animation.png",space:n})));const i=n.addDrawable(d(0,200,(0,t.SpriteDrawer)({url:"./resources/bunny_animation.png",space:n,animationConfig:{frameCount:8,getFrame:t=>({left:200*t,top:0,width:200,height:238})}})));i.animate({animation:i.data.animate(10,3.5)}),i.animate({animation:i.data.animate(20,7),putToQueue:!0}),n.draw()},map:e=>{const n=(0,t.Space)(e,{scale:1,center:{x:0,y:100}});n.addDrawable(a({mainStep:100,count:2})),n.addDrawable({x:0,y:0,scale:2,...o(10,"red")}),(0,t.installCanvasControll)(n,{rotationThreshold:.2}),n.draw()},movingObjects:n=>{const a=(0,t.Space)(n,{scale:.6});e().forEach((t=>a.addDrawable({selectable:!0,movable:!0,angle:Math.random(),scale:Math.random()+.5,...t}))),(0,t.installSelection)(a);const i=(0,t.installMoveObjects)(a,{disableRotation:!0});(0,t.installCanvasControll)(a,{disableRotation:!0,enable:()=>!i.moving()}),a.draw()},children:e=>{const n=(0,t.Space)(e,{scale:.6});n.addDrawable(a({mainStep:200})),n.addDrawable(u(100,40)),n.addDrawable(u(-100,40)),n.addDrawable(u(0,-100)),(0,t.installSelection)(n);const i=(0,t.installMoveObjects)(n,{disableRotation:!0});(0,t.installCanvasControll)(n,{disableRotation:!0,enable:()=>!i.moving()}),n.draw()},game:e=>{const n=(0,t.Space)(e,{scale:1,center:{x:0,y:0}});n.addDrawable(((t,e=100)=>({draw(n){const a=t.getBBox(!0),o=(Math.round(a.x/e)-1)*e,r=(Math.round(a.y/e)-1)*e;n.strokeStyle="#00000020",n.lineWidth=3,n.beginPath(),i(o,a.x+a.w+1,e).forEach((t=>{n.moveTo(t,a.y),n.lineTo(t,a.y+a.h)})),i(r,a.y+a.h+1,e).forEach((t=>{n.moveTo(a.x,t),n.lineTo(a.x+a.w,t)})),n.closePath(),n.stroke()}}))(n));const a=new v(n);a.addPlayer(),a.addHud(),a.run()}};window.onload=()=>{let t=document.getElementById("canvas"),e=null;document.getElementById("demo-selector").onchange=function(){const n=t.cloneNode(!0);e&&e.reset(),t.parentNode.replaceChild(n,t),t=n,e=p[this.value](t)},document.getElementById("demo-selector").onchange()}})()})();