(()=>{var t={349:function(t){var n;n=()=>(()=>{"use strict";var t={d:(n,e)=>{for(var i in e)t.o(e,i)&&!t.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:e[i]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};t.r(n),t.d(n,{Space:()=>r,SpriteDrawer:()=>f,installCanvasControll:()=>u,installClicks:()=>s,installSelection:()=>c});var e=function(t,n,e){var i=n.center,r=void 0===i?{x:0,y:0}:i,o=n.scale,a=void 0===o?1:o,c=n.angle,s=void 0===c?0:c,l=n.rotationCenter,u=void 0===l?{x:0,y:0}:l;return function(t,n,e){if(0==e)return t;var i={x:t.x-n.x,y:t.y-n.y},r=Math.hypot(i.x,i.y);if(0==r)return t;var o=Math.atan2(i.y,i.x)+e,a=Math.cos(o)*r,c=Math.sin(o)*r;return{x:n.x+a,y:n.y+c}}({x:(t.x-r.x-((null==e?void 0:e.x)||0))/a,y:(t.y-r.y-((null==e?void 0:e.y)||0))/a},u,-s)},i=function(){return i=Object.assign||function(t){for(var n,e=1,i=arguments.length;e<i;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t},i.apply(this,arguments)},r=function(t,n){var r=t.getContext("2d");if(null===r)throw TypeError("Can't get context2d from canvas");var o=[],a=function(t,n){var e=t.center,i=t.angle,o=t.rotationCenter,a=t.scale;e&&r.translate(e.x,e.y),n&&r.translate(n.x,n.y),a&&r.scale(a,a),i&&(o&&r.translate(o.x,o.y),r.rotate(i),o&&r.translate(-o.x,-o.y))},c={center:{x:0,y:0},scale:n.scale,angle:n.angle,rotationCenter:Object.assign({x:0,y:0},n.rotationCenter)},s=function(){var t=v.position,n=(v.position.scale||1)*v.pixelRatio;return i(i({},t),{scale:n,center:{x:t.center.x*n,y:t.center.y*n}})},l=n.center||{x:0,y:0},u=function(){var n=(v.position.scale||1)*v.pixelRatio;return{x:t.width/2-n*l.x,y:t.height/2-n*l.y}},f=!1,d=function(){var t=Date.now(),n=!1;o.forEach((function(e){e.applyAnimation(t)&&(n=!0)})),n?(v.draw(),requestAnimationFrame(d)):f=!1},v={options:n,canvas:t,objects:o,pixelRatio:1,position:c,addObject:function(t){return t.parent=this,o.push(t),t},addDrawable:function(t){return this.addObject(function(t){var n={center:{x:t.x||0,y:t.y||0},angle:t.angle,scale:t.scale,rotationCenter:t.rotationCenter};if(t.selectable&&void 0===t.checkInside)throw TypeError("Drawable should have checkInside method to be selectable");var i={selected:!1},r={x:0,y:0},o={func:function(t){return!1},queue:[],start:-1},a=function(t){void 0===t&&(t=-1);var n=o.queue.shift();n&&(o.func=n,o.start=t)};return{parent:void 0,orig:t,inAnimationLoop:!1,selectable:t.selectable||!1,position:n,data:t.data,draw:function(n){return t.draw.call(this,n)},getSpace:function(){if(!this.parent)throw ReferenceError("Couldn't traverse to space from object. Parent is null.");return"selectable"in this.parent?this.parent.getSpace():this.parent},checkInside:function(n){if(!t.checkInside)return!1;var e=this.transform(n),i=t.checkInside.call(this,e);return i&&Object.assign(r,e),i},selected:function(t){return void 0!==t&&(i.selected=t),i.selected},click:function(){t.onClick&&t.onClick(r)},clickable:function(){return void 0!==t.onClick},transform:function(t){var i=this.parent?this.parent.transform(t):t;return e(i,n)},animate:function(t){var n=t.animation,e=t.force,i=void 0!==e&&e,r=t.putToQueue,a=void 0!==r&&r;i||!this.inAnimationLoop?(this.inAnimationLoop=!0,o.func=n,o.start=-1,this.getSpace().triggerAnimation()):a&&o.queue.push(n)},stopAnimation:function(t){void 0===t&&(t=!1),t||0==o.queue.length?this.inAnimationLoop=!1:a()},applyAnimation:function(t){return!!this.inAnimationLoop&&(o.start<0?o.start=t:o.func.call(this,t-o.start)||(0==o.queue.length?this.inAnimationLoop=!1:a(t)),this.inAnimationLoop)}}}(t))},draw:function(){r.clearRect(0,0,t.width,t.height),a(s(),u()),o.forEach((function(t){r.save(),a(t.position),t.draw(r),r.restore()})),r.resetTransform()},triggerAnimation:function(){f||(f=!0,requestAnimationFrame(d))},launch:function(){var t=this;if(this.options.animationTick){var n=this,e=function(){var i;null===(i=t.options.animationTick)||void 0===i||i.call(n,0),t.draw(),requestAnimationFrame(e)};requestAnimationFrame(e)}else console.warn("Set animationTick in space options to make animation work. Ignoring launch.")},transform:function(t){return e(t,s(),u())}};return v.pixelRatio=function(t,n){var e=n.pixelRatio,i=n.onResize,r=n.setupAutoResize,o=1;return(void 0===r||r)&&(i||(o=e||window.devicePixelRatio,i=function(){t.canvas.width=t.canvas.offsetWidth*o,t.canvas.height=t.canvas.offsetHeight*o,t.draw()}),window.onresize=i,i()),o}(v,n),v},o=function(t){var n=t.space,e=t.pos,i=t.filter,r=t.prepare,o=t.getFirst,a=void 0!==o&&o,c=null;return n.objects.forEach((function(t){r&&r(t),a&&null!=c||i&&!i(t)||!t.checkInside(e)||(c=t)})),c},a=function(t,n,e){t.canvas.addEventListener(n,(function(t){e({x:t.offsetX,y:t.offsetY})}))},c=function(t,n){var e=(n=n||{firstIfMany:!1}).firstIfMany;return a(t,"click",(function(n){var i=o({space:t,pos:n,getFirst:e,filter:function(t){return t.selectable},prepare:function(t){return t.selected(!1)}});null!==i&&i.selected(!0),t.draw()})),{}},s=function(t,n){var e=(n=n||{firstIfMany:!1}).firstIfMany;return a(t,"click",(function(n){var i=o({space:t,pos:n,getFirst:e,filter:function(t){return t.clickable()}});null!==i&&i.click(),t.draw()})),{}},l=function(){return l=Object.assign||function(t){for(var n,e=1,i=arguments.length;e<i;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t},l.apply(this,arguments)},u=function(t){t.canvas.style.touchAction="none";var n={startPos:{x:0,y:0},startCanvPos:{x:0,y:0},moving:!1},e=function(e){n.startPos=e,n.startCanvPos=t.position.center||{x:0,y:0},n.moving=!0,t.draw()},i=function(e){if(n.moving){var i=t.position.scale||1;t.position.center={x:n.startCanvPos.x+(e.x-n.startPos.x)/i,y:n.startCanvPos.y+(e.y-n.startPos.y)/i}}t.draw()},r=function(){n.moving=!1,t.draw()},o=function(n){t.position.scale=(t.position.scale||1)*n,t.position.center,t.draw()};t.canvas.addEventListener("wheel",(function(t){o(t.deltaY>.1?.95:t.deltaY<-.1?1.05:1),t.preventDefault()})),a(t,"mousedown",e),a(t,"mouseup",r),a(t,"mousemove",i),function(t,n){var e=n.startMove,i=n.endMove,r=n.move,o=n.scale,a=n.rotate,c={center:void 0,rotate:void 0,distance:void 0},s=t.canvas.getBoundingClientRect(),u=function(t,n){var u=function(t){var n=Array.from(t).filter((function(t){return t.identifier<2})).sort((function(t,n){return t.identifier-n.identifier})).map((function(t){return{x:t.clientX-s.x,y:t.clientY-s.y}}));if(0==n.length)return{center:void 0,rotate:void 0,distance:void 0};var e=n.reduce((function(t,n){return{x:t.x+n.x,y:t.y+n.y}}),{x:0,y:0}),i={distance:void 0,rotate:void 0};if(n.length>1){var r={x:n[0].x-n[1].x,y:n[0].y-n[1].y};i.distance=Math.hypot(r.x,r.y),i.rotate=Math.atan2(r.y,r.x)}return l({center:{x:e.x/n.length,y:e.y/n.length}},i)}(t.touches);c.distance&&u.distance&&o(u.distance/c.distance),c.rotate&&u.rotate&&a(u.rotate-c.rotate),u.center&&!c.center?e(u.center):!u.center&&c.center?i():u.center&&c.center&&r(u.center),Object.assign(c,u)};t.canvas.addEventListener("touchstart",(function(t){return u(t)})),t.canvas.addEventListener("touchend",(function(t){return u(t)})),t.canvas.addEventListener("touchcancel",(function(t){return u(t)})),t.canvas.addEventListener("touchmove",(function(t){return u(t)}))}(t,{startMove:e,move:i,endMove:r,rotate:function(n){t.position.angle=(t.position.angle||0)+n,t.draw()},scale:o})},f=function(t){var n=t.size,e=void 0===n?{w:0,h:0}:n,i=t.drawLoading,r=t.space,o=t.crop,a=void 0===o?{}:o,c=t.animationConfig,s=function(t,n){var e={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&n.indexOf(i)<0&&(e[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)n.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(e[i[r]]=t[i[r]])}return e}(t,["size","drawLoading","space","crop","animationConfig"]),l=new Image(e.w?e.w:void 0,e.h?e.h:void 0),u=function(t){var n=t.url,e=t.content,i=t.base64,r=t.dataType,o=void 0===r?"image/svg+xml":r;if(!n&&!e&&!i)throw TypeError("You should initialize sprite drawer with url, content or base64");if(n)return n;var a=i;return!a&&e&&(a=btoa(e)),"data:".concat(o,";base64,").concat(a)}(s),f=i||function(t){t.beginPath(),t.fillStyle="#00000080";var n=e.w||100,i=e.h||100;t.rect(-n/2,-i/2,n,i),t.fill(),t.closePath()},d={loaded:!1,frame:void 0,animationConfig:c,draw:function(t){this.loaded?function(t,n){var i={left:a.left||0,top:a.top||0,width:a.width||0,height:a.height||0},r=e.w,o=e.h;n.frame&&(Object.assign(i,n.frame),r=n.frame.width,o=n.frame.height),t.drawImage(l,i.left,i.top,i.width,i.height,-r/2,-o/2,r,o)}(t,this):f(t)},animate:function(t,n){var e,i=this;if(!this.animationConfig)return function(t){return!1};var r=1e3/t,o=(null===(e=this.animationConfig)||void 0===e?void 0:e.frameCount)||1;return function(t){var e,a=0|t/r,c=a%o;return i.frame=null===(e=i.animationConfig)||void 0===e?void 0:e.getFrame(c),void 0===n||a/o<n}}};return c&&(d.frame=c.getFrame(c.defaultIndex||0)),l.onload=function(){d.loaded=!0,0===e.w&&(e.w=l.naturalWidth-(a.left||0),e.h=l.naturalHeight-(a.top||0)),a.width=a.width||l.naturalWidth-(a.left||0),a.height=a.height||l.naturalHeight-(a.top||0),r&&r.draw()},l.src=u,d};return n})(),t.exports=n()}},n={};function e(i){var r=n[i];if(void 0!==r)return r.exports;var o=n[i]={exports:{}};return t[i].call(o.exports,o,o.exports,e),o.exports}(()=>{"use strict";var t=e(349);window.onload=()=>{const n=(0,t.Space)(document.getElementById("canvas"),{scale:2,center:{x:0,y:100}});n.addDrawable((({count:t=20,mainStep:n=100,secondaryDivisions:e=2})=>{const i=t*n,r=({ctx:t,pos:n,width:e,color:r="#888",horizontal:o=!0})=>{t.beginPath(),t.lineWidth=e,t.strokeStyle=r,o?(t.moveTo(-i,n),t.lineTo(i,n)):(t.moveTo(n,-i),t.lineTo(n,i)),t.stroke(),t.closePath()};return{x:0,y:0,draw(i){for(let o=-t;o<=t;++o){let a=n*o;if(r({ctx:i,pos:a,width:2,horizontal:!0}),r({ctx:i,pos:a,width:2,horizontal:!1}),o<t)for(let t=1;t<e;++t){const o=a+t/e*n;r({ctx:i,pos:o,color:"#ccc",width:1,horizontal:!0}),r({ctx:i,pos:o,color:"#ccc",width:1,horizontal:!1})}}}}})({mainStep:100})),n.addDrawable({x:0,y:0,scale:2,...(10,"red",{draw(t){t.beginPath(),t.arc(0,0,10,0,2*Math.PI),t.fillStyle="red",t.fill(),t.closePath()},checkInside:t=>Math.hypot(t.x,t.y)<10})}),(0,t.installCanvasControll)(n),n.draw()}})()})();