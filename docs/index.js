(()=>{var t={349:function(t){var e;e=()=>(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Space:()=>l,SpriteDrawer:()=>y,installCanvasControll:()=>p,installClicks:()=>h,installSelection:()=>d});var n=function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},n.apply(this,arguments)},r=function(t){return n(n({},t),{add:function(e){return r({x:t.x+e.x,y:t.y+e.y})},sub:function(e){return r({x:t.x-e.x,y:t.y-e.y})},mul:function(e){return r({x:t.x*e,y:t.y*e})}})},o=function(t,e,n){if(0==n)return t;var o={x:t.x-e.x,y:t.y-e.y},i=Math.hypot(o.x,o.y);if(i<1e-6)return t;var a=Math.atan2(o.y,o.x)+n,c={x:Math.cos(a)*i,y:Math.sin(a)*i};return r(e).add(c)},i=function(t,e,n){var i=e.center,a=void 0===i?{x:0,y:0}:i,c=e.scale,s=void 0===c?1:c,l=e.angle,u=void 0===l?0:l,f=e.rotationCenter,d=void 0===f?{x:0,y:0}:f;return o(r(t).sub(a).sub(n||{x:0,y:0}).mul(1/s),d,-u)},a=function(t,e,n){var r=e.center,o=e.angle,i=e.rotationCenter,a=e.scale;r&&t.translate(r.x,r.y),n&&t.translate(n.x,n.y),a&&t.scale(a,a),o&&(i&&t.translate(i.x,i.y),t.rotate(o),i&&t.translate(-i.x,-i.y))},c=function(t,e){var n,r;if(e.rotationCenter&&e.angle){var i=o(t,e.rotationCenter,e.angle),a={x:i.x-t.x,y:i.y-t.y};return Object.assign(e,{center:{x:((null===(n=e.center)||void 0===n?void 0:n.x)||0)+a.x,y:((null===(r=e.center)||void 0===r?void 0:r.y)||0)+a.y},rotationCenter:t}),a}return e.rotationCenter=t,{x:0,y:0}},s=function(){return s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},s.apply(this,arguments)},l=function(t,e){var n=t.getContext("2d");if(null===n)throw TypeError("Can't get context2d from canvas");var r=[],o={center:{x:0,y:0},scale:e.scale,angle:e.angle,rotationCenter:Object.assign({x:0,y:0},e.rotationCenter)},c=function(){var t=h.position,e=(h.position.scale||1)*h.pixelRatio;return s(s({},t),{scale:e,center:{x:t.center.x*e,y:t.center.y*e}})},l=e.center||{x:0,y:0},u=function(){var e=(h.position.scale||1)*h.pixelRatio;return{x:t.width/2-e*l.x,y:t.height/2-e*l.y}},f=!1,d=function(){var t=Date.now(),e=!1;r.forEach((function(n){n.applyAnimation(t)&&(e=!0)})),e?(h.draw(),requestAnimationFrame(d)):f=!1},h={options:e,canvas:t,objects:r,pixelRatio:1,position:o,addObject:function(t){return t.parent=this,r.push(t),t},addDrawable:function(t){return this.addObject(function(t){var e={center:{x:t.x||0,y:t.y||0},angle:t.angle,scale:t.scale,rotationCenter:t.rotationCenter};if(t.selectable&&void 0===t.checkInside)throw TypeError("Drawable should have checkInside method to be selectable");var n={selected:!1},r={x:0,y:0},o={func:function(t){return!1},queue:[],start:-1},c=function(t){void 0===t&&(t=-1);var e=o.queue.shift();e&&(o.func=e,o.start=t)};return{parent:void 0,orig:t,inAnimationLoop:!1,selectable:t.selectable||!1,position:e,data:t.data,draw:function(e){return a(e,this.position),t.draw.call(this,e)},getSpace:function(){if(!this.parent)throw ReferenceError("Couldn't traverse to space from object. Parent is null.");return"selectable"in this.parent?this.parent.getSpace():this.parent},checkInside:function(e){if(!t.checkInside)return!1;var n=this.transform(e),o=t.checkInside.call(this,n);return o&&Object.assign(r,n),o},selected:function(t){return void 0!==t&&(n.selected=t),n.selected},click:function(){t.onClick&&t.onClick(r)},clickable:function(){return void 0!==t.onClick},transform:function(t){var n=this.parent?this.parent.transform(t):t;return i(n,e)},animate:function(t){var e=t.animation,n=t.force,r=void 0!==n&&n,i=t.putToQueue,a=void 0!==i&&i;r||!this.inAnimationLoop?(this.inAnimationLoop=!0,o.func=e,o.start=-1,this.getSpace().triggerAnimation()):a&&o.queue.push(e)},stopAnimation:function(t){void 0===t&&(t=!1),t||0==o.queue.length?this.inAnimationLoop=!1:c()},applyAnimation:function(t){return!!this.inAnimationLoop&&(o.start<0?o.start=t:o.func.call(this,t-o.start)||(0==o.queue.length?this.inAnimationLoop=!1:c(t)),this.inAnimationLoop)}}}(t))},draw:function(){n.clearRect(0,0,t.width,t.height),a(n,c(),u()),r.forEach((function(t){n.save(),t.draw(n),n.restore()})),n.resetTransform()},triggerAnimation:function(){f||(f=!0,requestAnimationFrame(d))},launch:function(){var t=this;if(this.options.animationTick){var e=this,n=function(){var r;null===(r=t.options.animationTick)||void 0===r||r.call(e,0),t.draw(),requestAnimationFrame(n)};requestAnimationFrame(n)}else console.warn("Set animationTick in space options to make animation work. Ignoring launch.")},transform:function(t){var e=this.pixelRatio;return i({x:t.x*e,y:t.y*e},c(),u())}};return h.pixelRatio=function(t,e){var n=e.pixelRatio,r=e.onResize,o=e.setupAutoResize,i=1;return(void 0===o||o)&&(r||(i=n||Math.ceil(window.devicePixelRatio),r=function(){t.canvas.width=t.canvas.offsetWidth*i,t.canvas.height=t.canvas.offsetHeight*i,t.draw()}),window.onresize=r,r()),i}(h,e),h},u=function(t){var e=t.space,n=t.pos,r=t.filter,o=t.prepare,i=t.getFirst,a=void 0!==i&&i,c=null;return e.objects.forEach((function(t){o&&o(t),a&&null!=c||r&&!r(t)||!t.checkInside(n)||(c=t)})),c},f=function(t,e,n){t.canvas.addEventListener(e,(function(t){n({x:t.offsetX,y:t.offsetY})}))},d=function(t,e){var n=(e=e||{firstIfMany:!1}).firstIfMany;return f(t,"click",(function(e){var r=u({space:t,pos:e,getFirst:n,filter:function(t){return t.selectable},prepare:function(t){return t.selected(!1)}});null!==r&&r.selected(!0),t.draw()})),{}},h=function(t,e){var n=(e=e||{firstIfMany:!1}).firstIfMany;return f(t,"click",(function(e){var r=u({space:t,pos:e,getFirst:n,filter:function(t){return t.clickable()}});null!==r&&r.click(),t.draw()})),{}},v=function(){return v=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},v.apply(this,arguments)},p=function(t,e){t.canvas.style.touchAction="none",t.canvas.style.userSelect="none";var n=e||{},o={startPos:{x:0,y:0},startCanvPos:r({x:0,y:0}),moving:!1},i=function(e){o.startPos=e,o.startCanvPos=r(t.position.center||{x:0,y:0}),o.moving=!0,t.draw()},a=function(e){if(o.moving){var n=t.position.scale||1;t.position.center=o.startCanvPos.add(r(e).sub(o.startPos).mul(1/n))}t.draw()},s=function(){o.moving=!1,t.draw()},l=function(e){t.position.scale=(t.position.scale||1)*e,t.draw()},u=function(e,n){c(t.transform(n),t.position),t.position.angle=(t.position.angle||0)+e,t.draw()},d=n.scaleForce||.05,h=n.rotateForce||.02;t.canvas.addEventListener("wheel",(function(t){if(t.ctrlKey&&n.ctrlWheelRotate){var e=t.deltaY>.1?h:t.deltaY<-.1?-h:0;u(e,{x:t.offsetX,y:t.offsetY})}else l(t.deltaY>.1?1-d:t.deltaY<-.1?1/(1-d):1);t.preventDefault()})),f(t,"mousedown",i),f(t,"mouseup",s),f(t,"mousemove",a),function(t,e){var n=e.startMove,r=e.endMove,o=e.move,i=e.scale,a=e.rotate,c={center:void 0,rotate:void 0,distance:void 0,count:0},s=t.canvas.getBoundingClientRect(),l=function(t,e){var l=function(t){var e=Array.from(t).filter((function(t){return t.identifier<2})).sort((function(t,e){return t.identifier-e.identifier})).map((function(t){return{x:t.clientX-s.x,y:t.clientY-s.y}}));if(0==e.length)return{center:void 0,rotate:void 0,distance:void 0};var n=e.reduce((function(t,e){return{x:t.x+e.x,y:t.y+e.y}}),{x:0,y:0}),r={distance:void 0,rotate:void 0,count:e.length};if(e.length>1){var o={x:e[0].x-e[1].x,y:e[0].y-e[1].y};r.distance=Math.hypot(o.x,o.y),r.rotate=Math.atan2(o.y,o.x)}return v({center:{x:n.x/e.length,y:n.y/e.length}},r)}(t.touches);c.distance&&l.distance&&i(l.distance/c.distance),c.rotate&&l.rotate?a(l.rotate-c.rotate,l.center):l.center&&!c.center?n(l.center):!l.center&&c.center?r():l.center&&c.center&&(l.count!==c.count?n(l.center):o(l.center)),Object.assign(c,l)};t.canvas.addEventListener("touchstart",(function(t){return l(t)})),t.canvas.addEventListener("touchend",(function(t){return l(t)})),t.canvas.addEventListener("touchcancel",(function(t){return l(t)})),t.canvas.addEventListener("touchmove",(function(t){return l(t)}))}(t,{startMove:i,move:a,endMove:s,rotate:u,scale:l})},y=function(t){var e=t.size,n=void 0===e?{w:0,h:0}:e,r=t.drawLoading,o=t.space,i=t.crop,a=void 0===i?{}:i,c=t.animationConfig,s=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}(t,["size","drawLoading","space","crop","animationConfig"]),l=new Image(n.w?n.w:void 0,n.h?n.h:void 0),u=function(t){var e=t.url,n=t.content,r=t.base64,o=t.dataType,i=void 0===o?"image/svg+xml":o;if(!e&&!n&&!r)throw TypeError("You should initialize sprite drawer with url, content or base64");if(e)return e;var a=r;return!a&&n&&(a=btoa(n)),"data:".concat(i,";base64,").concat(a)}(s),f=r||function(t){t.beginPath(),t.fillStyle="#00000080";var e=n.w||100,r=n.h||100;t.rect(-e/2,-r/2,e,r),t.fill(),t.closePath()},d={loaded:!1,frame:void 0,animationConfig:c,draw:function(t){this.loaded?function(t,e){var r={left:a.left||0,top:a.top||0,width:a.width||0,height:a.height||0},o=n.w,i=n.h;e.frame&&(Object.assign(r,e.frame),o=e.frame.width,i=e.frame.height),t.drawImage(l,r.left,r.top,r.width,r.height,-o/2,-i/2,o,i)}(t,this):f(t)},animate:function(t,e){var n,r=this;if(!this.animationConfig)return function(t){return!1};var o=1e3/t,i=(null===(n=this.animationConfig)||void 0===n?void 0:n.frameCount)||1;return function(t){var n,a=0|t/o,c=a%i;return r.frame=null===(n=r.animationConfig)||void 0===n?void 0:n.getFrame(c),void 0===e||a/i<e}}};return c&&(d.frame=c.getFrame(c.defaultIndex||0)),l.onload=function(){d.loaded=!0,0===n.w&&(n.w=l.naturalWidth-(a.left||0),n.h=l.naturalHeight-(a.top||0)),a.width=a.width||l.naturalWidth-(a.left||0),a.height=a.height||l.naturalHeight-(a.top||0),o&&o.draw()},l.src=u,d};return e})(),t.exports=e()}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}(()=>{"use strict";var t=n(349);window.onload=()=>{const e=(0,t.Space)(document.getElementById("canvas"),{scale:1,center:{x:0,y:100},pixelRatio:1});e.addDrawable((({count:t=20,mainStep:e=100,secondaryDivisions:n=2})=>{const r=t*e,o=({ctx:t,pos:e,width:n,color:o="#888",horizontal:i=!0})=>{t.beginPath(),t.lineWidth=n,t.strokeStyle=o,i?(t.moveTo(-r,e),t.lineTo(r,e)):(t.moveTo(e,-r),t.lineTo(e,r)),t.stroke(),t.closePath()};return{x:0,y:0,draw(r){for(let i=-t;i<=t;++i){let a=e*i;if(o({ctx:r,pos:a,width:2,horizontal:!0}),o({ctx:r,pos:a,width:2,horizontal:!1}),i<t)for(let t=1;t<n;++t){const i=a+t/n*e;o({ctx:r,pos:i,color:"#ccc",width:1,horizontal:!0}),o({ctx:r,pos:i,color:"#ccc",width:1,horizontal:!1})}}}}})({mainStep:100,count:2})),e.addDrawable({x:0,y:0,scale:2,...(10,"red",{draw(t){t.beginPath(),t.arc(0,0,10,0,2*Math.PI),t.fillStyle="red",t.fill(),t.closePath()},checkInside:t=>Math.hypot(t.x,t.y)<10})}),(0,t.installCanvasControll)(e,{ctrlWheelRotate:!0}),e.draw()}})()})();